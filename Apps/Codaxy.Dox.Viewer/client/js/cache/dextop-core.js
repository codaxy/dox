Ext.define("Dextop.direct.LongPollingProvider",{extend:"Ext.direct.JsonProvider",alias:"direct.longpollingprovider",uses:["Ext.direct.ExceptionEvent"],requires:["Ext.Ajax"],connected:!1,nextStart:0,interval:3e3,constructor:function(){this.callParent(arguments),this.addEvents("beforepoll","poll")},isConnected:function(){return this.connected},poll:function(){this.connected&&(this.baseParams=this.baseParams||{},Ext.apply(this.baseParams,{start:this.nextStart}),this.fireEvent("beforepoll",this)!==!1&&(typeof this.url=="function"?this.url(this.baseParams):Ext.Ajax.request({url:this.url,callback:this.onData,scope:this,params:this.baseParams})))},connect:function(){if(!this.url)throw"Error initializing LongPollingProvider, no url configured.";this.connected=!0,this.fireEvent("connect",this),this.poll()},disconnect:function(){this.connected&&(this.connected=!1,this.fireEvent("disconnect",this))},onData:function(n,t,i){var f=this,r=0,e,u;if(t){for(u=f.createEvents(i),e=u.length;r<e;++r)u[r].nextStart>this.nextStart&&(this.nextStart=u[r].nextStart),t&=u[r].success,f.fireEvent("data",f,u[r]);t?Ext.defer(this.poll,10,this):Ext.defer(this.poll,this.interval,this)}else Ext.defer(this.poll,this.interval,this),f.fireEvent("data",f,Ext.create("Ext.direct.ExceptionEvent",{data:null,code:Ext.direct.Manager.self.exceptions.TRANSPORT,message:"Unable to connect to the server.",xhr:i}))}}),Ext.ns("Dextop.remoting"),Ext.define("Dextop.LookupModel",{extend:"Ext.data.Model",fields:["id","text"],idProperty:"id"}),Ext.define("Dextop.remoting.Proxy",{statics:{ajaxUrlBase:undefined,handlerTypes:{alert:{failure:function(n){n?Dextop.alert({type:n.type||"error",msg:n.exception}):Dextop.alert({type:"error",msg:"Communication error ocurred."})}},notify:{failure:function(n){n?Dextop.notify({type:n.type||"error",msg:n.exception}):Dextop.notify({type:"error",msg:"Communication error ocurred."})}},none:{failure:Ext.emptyFn}},createHandler:function(n,t){if(!n)return{};if(typeof n=="function")return{scope:t,callback:n};if(typeof n!="object")throw"Invalid callback specified.";n.type||(n.type="alert");var i=Dextop.remoting.Proxy.handlerTypes[n.type];if(!i)throw"Remote method callback type '"+n.type+"' not found.";return Ext.applyIf(n,i),delete n.type,t=n.scope||t,n.setLoading&&(n.setLoadingTarget=n.setLoadingTarget||t,n.setMask=function(){n.setLoadingTarget.setLoading(n.setLoading)},n.removeMask=function(){n.setLoadingTarget.setLoading(!1)}),Ext.applyIf(n,{callback:function(i){n.removeMask&&n.removeMask(),n.cleanup&&n.cleanup.call(t),n.handler&&n.handler.call(t,i),i?i.success&&n.success?n.success.call(t,i.result):i.success||(i.result&&i.result.type=="session"?Dextop.getSession().handleSessionTermination():n.failure&&n.failure.call(t,i.result)):(n.aborted&&n.aborted.call(t),n.failure&&n.failure.call(t))},scope:t})}},remoteId:undefined,constructor:function(n){if(!n||!n.remoteId)throw new"Invalid Dextop.remoting.Proxy config specified!";this.remoteId=n.remoteId,this.components=n.components},invokeRemoteMethod:function(n,t,i,r){var u=Dextop.remoting.Proxy.createHandler(n,t);u.prepare&&u.prepare.call(u.scope),u.setMask&&u.setMask(),Remote.invoke(this.remoteId,i,this.encodeArguments(r),u.callback,u.scope)},submitForm:function(n,t,i,r,u){var f=Dextop.remoting.Proxy.createHandler(n,t),o;f.prepare&&f.prepare.call(f.scope),f.setMask&&f.setMask();var h=!1,e=r,s=undefined;r&&r.$className==="Ext.form.Basic"&&(o=Ext.create("Ext.form.action.Submit",{form:r}),e=o.buildForm(),s=r.getFieldValues(),h=!0),Remote.submitForm(e,{callback:f.callback,scope:f.scope,params:{_rcpId:this.remoteId,_rcpMethod:i,_rcpArguments:this.encodeArguments(u),_rcpFieldValues:Ext.encode(s)}}),h&&Ext.removeNode(e)},Dispose:function(n,t){this.invokeRemoteMethod(n,t,"Dispose",[])},Instantiate:function(n,t,i,r){this.invokeRemoteMethod(i,r,"Instantiate",[n,t])},getSubRemoteId:function(n){return this.remoteId+"."+n},encodeArguments:function(n){for(var t=0;t<n.length;t++)Ext.isDefined(n[t])?n[t]!==null&&(n[t].$className==="Ext.form.Basic"?n[t]=Ext.encode(n[t].getFieldValues()):typeof n[t]=="object"&&(n[t]=Ext.encode(n[t]))):n[t]=null;return Ext.encode(n)},getAjaxUrl:function(n){var t=Dextop.remoting.Proxy.ajaxUrlBase+"&remoteId="+this.remoteId;return n&&(t+="&"+Ext.urlEncode(n)),t},getComponentConfig:function(n){var t=this.findComponentConfig(n);if(!t)throw"Component '"+n+"' not defined.";return t},findComponentConfig:function(n){return this.components?this.components[n]:undefined},createProxy:function(n){var t=this.getComponentConfig(n+"Proxy");return Dextop.create(t)},createStore:function(n,t){var i=this.findComponentConfig(n+"Proxy"),f,e,r,u;if(i)return f=Ext.apply(Ext.clone(i),t?t.proxyOptions:undefined),e=Dextop.create(f),Ext.create("Ext.data.Store",Ext.apply({model:i.model,proxy:e},t));i=this.findComponentConfig(n+"LookupData");if(i)return Ext.create("Ext.data.ArrayStore",Ext.apply({model:"Dextop.LookupModel",proxy:{type:"memory",reader:{type:"array",idProperty:"id"}},data:i},t));i=this.findComponentConfig(n+"SharedLookupData");if(i)return r=Dextop.getSession(),r.setSharedLookupData(i),u=r.getSharedLookupData(i.name),Ext.create("Ext.data.ArrayStore",Ext.apply({model:"Dextop.LookupModel",proxy:{type:"memory",reader:{type:"array",idProperty:"id"}},data:u},t));throw"Could not create store '"+n+"'. Component configuration is not defined.";},createLiveStore:function(n,t){var i=this.getComponentConfig(n+"LiveStore");return Dextop.create(Ext.apply(Ext.clone(i),t))},createGridColumns:function(n,t){var i=this.findComponentConfig(n+"GridHeaders"),r;i||(r=this.findComponentConfig(n+"Proxy")||this.findComponentConfig(n+"LiveStore"),r&&(i=r.model));if(!i)throw"Could not create headers '"+n+"'. Component configuration is not defined.";return t=t||{},t.remote=this,Dextop.data.GridColumnsFactory.create(this.replaceLast(i,".model.",".columns."),t)},replaceLast:function(n,t,i){var r=n.lastIndexOf(t);return r<0?n:n.substring(0,r)+i+n.substring(r+t.length)}}),Ext.ns("Dextop.remoting"),Ext.define("Dextop.remoting.Remotable",{statics:{remotes:{},registerRemote:function(n){this.remotes[n.remoteId]=n},unregisterRemote:function(n){this.remotes[n.remoteId]=undefined},findRemote:function(n){return this.remotes[n]},dispatchServerMessages:function(n){for(var i,t=0;t<n.length;t++)i=this.findRemote(n[t].remoteId),i&&i.processServerMessage&&i.processServerMessage(n[t].message)}},initRemote:function(n){if(!n)throw"Remote config not set.";if(!n.remoteId)throw"Remote config has no remoteId set";n.alias||(n.alias=this.getNestedTypeName(".remoting.Proxy")),this.remote=Dextop.create(n),this.onServerMessage&&(this.remote.processServerMessage=Ext.bind(this.onServerMessage,this)),Dextop.remoting.Remotable.registerRemote(this.remote)},destroyRemote:function(){this.remote&&(this.remote.processServerMessage&&delete this.remote.processServerMessage,Dextop.remoting.Remotable.unregisterRemote(this.remote),delete this.remote)},getNestedTypeName:function(n){return this.$className+n}}),Ext.define("Dextop.data.LiveStore.remoting.Proxy",{extend:"Dextop.remoting.Proxy",Subscribe:function(n,t){this.invokeRemoteMethod(n,t,"Subscribe",[])}}),Ext.define("Dextop.data.Proxy.remoting.Proxy",{extend:"Dextop.remoting.Proxy",Load:function(n,t,i){this.invokeRemoteMethod(t,i,"Load",[n])},Create:function(n,t,i){this.invokeRemoteMethod(t,i,"Create",[n])},Update:function(n,t,i){this.invokeRemoteMethod(t,i,"Update",[n])},Destroy:function(n,t,i){this.invokeRemoteMethod(t,i,"Destroy",[n])}}),Ext.define("Dextop.RemotableBase.remoting.Proxy",{extend:"Dextop.remoting.Proxy"}),Ext.define("Dextop.Panel.remoting.Proxy",{extend:"Dextop.RemotableBase.remoting.Proxy"}),Ext.define("Dextop.Session.remoting.Proxy",{extend:"Dextop.remoting.Proxy",ExtendSession:function(n,t){this.invokeRemoteMethod(n,t,"ExtendSession",[])},RegisterLookupDataVersion:function(n,t,i,r){this.invokeRemoteMethod(i,r,"RegisterLookupDataVersion",[n,t])}}),Ext.define("Dextop.Window.remoting.Proxy",{extend:"Dextop.RemotableBase.remoting.Proxy"}),Ext.define("Dextop.Window`1.remoting.Proxy",{extend:"Dextop.Window.remoting.Proxy"}),Ext.define("Dextop.RemotableConfig.remoting.Proxy",{extend:"Dextop.remoting.Proxy"}),Ext.define("Ext.data.Writer",{alias:"writer.array",constructor:function(n){Ext.apply(this,n)},getRecordData:function(n){for(var i=n.fields,r=[],t=0;t<i.getCount();t++)r[t]=n.get(i.getAt(t).name)||null;return r}}),Ext.ns("Dextop.data"),Ext.define("Dextop.data.GridColumnsFactory",{statics:{create:function(n,t){var r,i;for(t=t||{},typeof n=="string"&&(r=Ext.create(n),n=r.getItems(t)),i=0;i<n.length;i++)n[i]=Dextop.data.GridColumnsFactory.createColumn(n[i],t);return n},columnDefaults:{int:{align:"right",field:{xtype:"numberfield"},renderer:Ext.util.Format.numberRenderer()},float:{align:"right",field:{xtype:"numberfield"},renderer:Ext.util.Format.numberRenderer()},string:{field:{xtype:"textfield"}},date:{align:"center",field:{xtype:"datefield"},renderer:Ext.util.Format.dateRenderer(),width:90},time:{align:"center",field:{xtype:"timefield"},renderer:function(n){return n?Ext.util.Format.date(n,"g:i A"):n},width:80},datetime:{align:"center",field:{xtype:"textfield"},renderer:function(n){return n?Ext.util.Format.date(n,Ext.Date.defaultFormat+" g:i A"):n}},boolean:{factory:function(n,t){Ext.applyIf(n,{xtype:"checkcolumn",editor:t.checkEditor,align:"center",width:40,field:{xtype:"checkbox"}})}},lookup:{factory:function(n,t){if(!t||!t.remote)throw"Invalid lookup options specified.";var i=t.remote.createStore(n.lookupId||n.dataIndex);n.readonly||(n.field={xtype:"combo",valueField:"id",displayField:"text",queryMode:"local",forceSelection:!0,disableKeyFilter:!0,store:i}),n.renderer||(n.renderer=function(n){var t=i.getById(n);return t?t.get("text"):n})}},"remote-lookup":{factory:function(n,t){if(!t||!t.remote)throw"Invalid remote-lookup options specified.";var i=t.remote.createStore(n.lookupId||n.dataIndex);!n.readonly&&n.field&&Ext.applyIf(n.field,{xtype:"combo",store:i,minChars:1,queryDelay:50}),!n.renderer&&n.valueNotFoundDataIndex&&(n.renderer=function(t,r,u){var f,e;return u.dirty&&u.modified&&n.field&&Ext.isDefined(u.modified[n.dataIndex])?(f=i.findRecord(n.field.valueField,t),f?f.get(n.field.displayField||n.field.valueField):t):e=u.get(n.valueNotFoundDataIndex)})}}},createColumn:function(n,t){if(n.type){var i=Dextop.data.GridColumnsFactory.columnDefaults[n.type];delete n.type,i&&(i.factory?i.factory(n,t):Ext.applyIf(n,i))}return n.readonly&&delete n.field,typeof n.renderer=="string"&&(n.renderer=Dextop.data.RendererFactory.create(n.renderer,n.rendererOptions)),t&&t.renderers&&t.renderers[n.dataIndex]&&(n.renderer=t.renderers[n.dataIndex]),Ext.isDefined(n.menuDisabled)||(n.menuDisabled=!0),n.tooltipTpl&&(n.renderer=Dextop.data.RendererFactory.create("tooltipTpl",{renderer:n.renderer,tooltipTpl:n.tooltipTpl}),delete n.tooltipTpl),n.columns&&(n.columns=Dextop.data.GridColumnsFactory.create(n.columns,t)),n}}}),Ext.ns("Dextop.data"),Ext.define("Dextop.data.LiveStore",{extend:"Ext.data.Store",mixins:{remotable:"Dextop.remoting.Remotable"},constructor:function(n){this.initRemote(n.remote),delete n.remote;if(!n.model)throw"Store model is not defined.";n.reader||(n.reader=Ext.create("Ext.data.ArrayReader",{model:n.model,root:"data"})),Ext.apply(n.reader,{totalProperty:undefined,successProperty:undefined}),this.proxy=Ext.create("Ext.data.ServerProxy",{model:this.model,reader:n.reader}),this.callParent(arguments)},onDestroy:function(){this.destroyRemote(),this.callParent(arguments)},load:function(){this.loading=!0,this.remote.Subscribe(function(n){n&&n.success||(this.loading=!1,this.fireEvent("load",this,null,!1))})},onServerMessage:function(n){var u,i,t;n.load&&(i=Ext.decode(n.load),t=this.reader.read({data:i}),this.loadRecords(t.records,{addRecords:!1}),this.loading&&(this.loading=!1,this.fireEvent("load",this,t.records,!0))),n.remove&&(i=Ext.decode(n.remove),t=this.reader.read({data:i}),this.remove(t.records));if(n.update)for(i=Ext.decode(n.update),t=this.reader.read({data:i}),u=0;u<t.records.length;u++){var f=t.records[u],e=f.getId(),r=this.getById(e);r&&(r.beginEdit(),r.set(f.data),r.endEdit(),r.commit())}n.add&&(i=Ext.decode(n.add),t=this.reader.read({data:i}),this.insert(this.getCount(),t.records)),this.autoSort&&this.sort()}}),Ext.ns("Dextop.data"),Ext.define("Dextop.data.Proxy",{extend:"Ext.data.ServerProxy",mixins:{remotable:"Dextop.remoting.Remotable"},requires:["Ext.data.ServerProxy","Dextop.remoting.Remotable"],defaultWriterType:"array",defaultReaderType:"array",remoteCallbackOptions:undefined,constructor:function(n){n=n||{},n.reader&&n.reader!=="array"||(n.reader=Ext.create("Ext.data.ArrayReader",{root:"data",totalProperty:"total"})),n.remote&&(this.initRemote(n.remote),delete n.remote),this.callParent(arguments)},applyEncoding:function(n){return n},doRequest:function(n,t,i){var u=[],f,e,r;switch(n.action){case"read":f=this.getParams(n),f.Params=Ext.apply(n.params||{},this.extraParams),u.push(f);break;case"create":case"update":case"destroy":if(!this.writer)throw"Proxy writer is not configured.";for(e=[],r=0;r<n.records.length;r++)e[r]=this.writer.getRecordData(n.records[r]);u.push(Ext.encode(e));break;default:throw"Uknown action "+n.action+".";}u.push(this.createCallback(n,t,i)),u.push(this),this[n.action+"Record"].apply(this,u)},createCallback:function(n,t,i){return Ext.apply({handler:function(r){this.processResponse(r.success,n,null,r,t,i)}},this.remoteCallbackOptions)},extractResponseData:function(n){return Ext.isString(n.result.data)&&(n.result.data=Ext.decode(n.result.data)),n.result},readRecord:function(){this.remote.Load.apply(this.remote,arguments)},createRecord:function(){this.remote.Create.apply(this.remote,arguments)},updateRecord:function(){this.remote.Update.apply(this.remote,arguments)},destroyRecord:function(){this.remote.Destroy.apply(this.remote,arguments)},onDestroy:function(){this.destroyRemote(),this.callParent(arguments)}}),Ext.ns("Dextop.data"),Ext.define("Dextop.data.RendererFactory",{statics:{defaultRenderer:function(n){return n},types:{number:function(){return Ext.util.Format.numberRenderer()},tooltipTpl:function(n){var n=n||{},i=new Ext.XTemplate(n.tooltipTpl),t;return i.compile(),t=n.renderer||Dextop.data.RendererFactory.defaultRenderer,function(n,r,u){var e=t(n,r,u),f=i.apply(u.data);return f?'<div data-qtip="'+f+'">'+e+"</div>":e}}},register:function(n,t){var i=function(){return t};Dextop.data.RendererFactory.types[n]=i},registerFactory:function(n,t){Dextop.data.RendererFactory.types[n]=t},create:function(n,t){var i=Dextop.data.RendererFactory.types[n];if(!i)throw"Renderer type '"+n+"' not defined.";return i(t)}}}),Ext.namespace("Dextop"),Ext.define("Dextop.ux.FormEditorWindow",{extend:"Ext.Window",title:"Edit Record",modal:!0,width:400,autoHeight:!0,formConfig:undefined,formItemsType:undefined,formItemsConfig:undefined,initComponent:function(){this.addEvents(["save"]),this.formConfig=this.formConfig||{};if(!this.formItemsType)throw"FormEditor requires formItemsType property to be configured.";var n=Ext.create(this.formItemsType).getItems(Ext.apply({remote:this.remote,data:this.data},this.formItemsConfig));this.form=Ext.create("Ext.form.Panel",Ext.applyIf(Ext.clone(this.formConfig),{bodyStyle:"padding: 5px",border:!1,items:n,buttons:[{formBind:!0,text:Dextop.saveText,scope:this,handler:function(){if(this.form.getForm().isValid()){var n=this.form.getForm().getFieldValues();this.fireEvent("save",this,this.form,n)}}},{text:Dextop.cancelText,scope:this,handler:function(){this.close()}}]})),Ext.apply(this,{layout:"fit",bodyStyle:"padding-bottom: 3px",items:[this.form]}),this.callParent()},updateRecord:function(n){this.form.getForm().updateRecord(n)}}),Ext.define("Dextop.ux.SwissArmyGrid",{extend:"Ext.grid.Panel",alias:"widget.swissarmygrid",model:"model",editing:undefined,editingOptions:undefined,storeName:undefined,storeOptions:undefined,columnModelName:undefined,columnModelOptions:undefined,paging:!1,pagingToolbarOptions:undefined,actionIconClsSuffix:undefined,actionIconClsPrefix:undefined,editOnDblClick:!1,confirmDeleteText:"Are you sure you want to remove the selected records?",pageSizeText:"Size: ",defaultRowEditingOptions:{removePhantomsOnCancel:!0},autoSelect:!0,initComponent:function(){if(!this.remote)throw"Swiss grid panel requires remote object to be configured.";this.store=this.remote.createStore(this.storeName||this.model,this.storeOptions),delete this.storeOptions,this.columnModelOptions=this.columnModelOptions||{},Ext.apply(this.columnModelOptions,{remote:this.remote,checkEditor:this.editing=="cell"}),this.columns=this.remote.createGridColumns(this.columnModelName||this.model,this.columnModelOptions),delete this.columnModelOptions,this.actionManager=Ext.create("Ext.ux.grid.plugin.ActionManager"),this.plugins=Ext.Array.from(this.plugins)||[],this.plugins.push(this.actionManager);if(this.autoSelect){var n=this.autoSelect===!0?{}:this.autoSelect;this.plugins.push(Ext.create("Ext.ux.grid.plugin.AutoSelect",n)),this.autoSelect=n}if(this.paging){if(this.bbar)throw"Grid does not support paging and bbar. Use them exclusively.";this.pagingToolbarOptions=this.pagingToolbarOptions||{},this.pagingToolbarOptions.items=Ext.Array.from(this.pagingToolbarOptions.items)||[],this.pagingToolbarOptions.items.push(["-",this.pageSizeText,{xtype:"pagesizecombo",store:this.store}]),this.bbar=Ext.create("Ext.PagingToolbar",Ext.apply({store:this.store},this.pagingToolbarOptions))}this.createEditingPlugin(),Ext.isArray(this.tbar)&&(this.tbar=this.actionManager.add(this.convertStringActions(this.tbar))),Ext.isArray(this.bbar)&&(this.bbar=this.actionManager.add(this.convertStringActions(this.bbar))),this.callParent(),this.editOnDblClick&&this.mon(this,"itemdblclick",function(){this.editRecord()},this)},getFirstEditorIndex:function(){for(var n=0;this.columns.length;n++)if(this.columns[n].field)return n},createEditingPlugin:function(){switch(this.editing){case"cell":this.cellEditing=this.createCellEditing(),this.plugins.push(this.cellEditing);break;case"row":this.rowEditing=this.createRowEditing(),this.plugins.push(this.rowEditing)}},createCellEditing:function(){return this.editingOptions=this.editingOptions||{},Ext.apply(this.editingOptions,{firstEditor:this.getFirstEditorIndex()}),Ext.create("Ext.grid.plugin.CellEditing",this.editingOptions)},createRowEditing:function(){return this.editingOptions=this.editingOptions||{},this.editingOptions.firstEditor=this.getFirstEditorIndex(),Ext.applyIf(this.editingOptions,this.defaultRowEditingOptions),Ext.create("Ext.grid.plugin.RowEditing",this.editingOptions)},createNewRecord:function(){return Ext.create(this.store.model,{})},convertStringActions:function(n){for(var t=0;t<n.length;t++)if(Ext.isString(n[t])){switch(this.editing){case"row":n[t]=this.convertRowEditorAction(n[t]);break;case"cell":n[t]=this.convertCellEditorAction(n[t]);break;case"form":n[t]=this.convertFormEditorAction(n[t])}Ext.isString(n[t])&&(n[t]=this.convertStringAction(n[t]))}return n},convertStringAction:function(n){switch(n){case"save":return{text:Dextop.saveText,iconCls:this.getActionIconCls(n),scope:this,handler:function(){this.store.sync()}};case"reload":return{text:Dextop.reloadText,iconCls:this.getActionIconCls(n),scope:this,handler:function(){this.store.load()}};case"edit":return{text:Dextop.editText,enableOnSingle:!0,key:[Ext.EventObject.ENTER],iconCls:this.getActionIconCls(n),scope:this,handler:function(){this.editRecord()}};case"remove":return{text:Dextop.removeText,iconCls:this.getActionIconCls(n),key:[Ext.EventObject.NUM_MINUS,Ext.EventObject.DELETE],enableOnSingle:!0,enableOnMultiple:!0,scope:this,handler:function(){this.cancelEditing(),Dextop.confirm({msg:this.confirmDeleteText,scope:this,fn:function(n){n=="yes"&&this.store.remove(this.getSelectedRecords())}})}}}return n},cancelEditing:function(){switch(this.editing){case"row":this.rowEditing.cancelEdit();break;case"cell":this.cellEditing.cancelEdit()}},convertRowEditorAction:function(n){switch(n){case"add":return{text:Dextop.addText,iconCls:this.getActionIconCls(n),scope:this,key:[Ext.EventObject.NUM_PLUS,Ext.EventObject.INSERT],handler:function(){var n=this.createNewRecord(),t=this.store.getCount();this.store.insertPhantom(t,n),this.editRecord(n)}}}return n},convertCellEditorAction:function(n){switch(n){case"add":return{text:Dextop.addText,iconCls:this.getActionIconCls(n),scope:this,key:[Ext.EventObject.NUM_PLUS,Ext.EventObject.INSERT],handler:function(){var n=this.createNewRecord(),t=this.store.getCount();this.store.insert(t,n),this.editRecord(n)}}}return n},convertFormEditorAction:function(n){switch(n){case"add":return{text:Dextop.addText,iconCls:this.getActionIconCls(n),scope:this,key:[Ext.EventObject.NUM_PLUS,Ext.EventObject.INSERT],handler:function(){var n=this.createNewRecord();this.formEdit(n,!0)}}}return n},editRecord:function(n){n=n||this.getSelectedRecord();if(n)switch(this.editing){case"row":this.rowEdit(n);break;case"cell":this.cellEdit(n);break;case"form":this.formEdit(n)}},cellEdit:function(n){this.cellEditing.cancelEdit(),this.cellEditing.startEditByPosition({row:this.store.indexOf(n),column:this.cellEditing.firstEditor})},rowEdit:function(n){this.rowEditing.cancelEdit(),this.rowEditing.startEdit(this.store.indexOf(n),this.rowEditing.firstEditor)},formEdit:function(n,t){this.editingOptions=this.editingOptions||{},this.editingOptions.formItemsType||(this.editingOptions.formItemsType=this.store.model.modelName.replace(".model.",".form."));var i=Ext.create("Dextop.ux.FormEditorWindow",Ext.apply({remote:this.remote,data:n.data,listeners:{scope:this,save:function(i,r){r.getForm().updateRecord(n);if(t){var f=this.store.getCount();this.store.insert(f,n)}i.close()}}},this.editingOptions));i.show()},getSelectedRecords:function(){return this.getSelectionModel().getSelection()},getSelectedRecord:function(){var n=this.getSelectedRecords();return n&&n.length>0?n[0]:undefined},getActionIconCls:function(n){return(this.actionIconClsPrefix||"")+n+(this.actionIconClsSuffix||"")}}),Ext.define("Ext.ux.CheckColumn",{extend:"Ext.grid.column.Column",alias:"widget.checkcolumn",editor:!0,processEvent:function(n,t,i,r,u,f){if(this.editor&&(n=="mousedown"||n=="keydown"&&(f.getKey()==f.ENTER||f.getKey()==f.SPACE))){var e=t.panel.store.getAt(r);return e.set(this.dataIndex,!e.data[this.dataIndex]),!1}return this.callParent(arguments)},renderer:function(n){var i=Ext.baseCSSPrefix,r=[i+"grid-checkheader"],t='<div class="'+i+'form-checkbox">&nbsp;</div>';return n&&r.push(i+"form-cb-checked"),t='<div class="'+r.join(" ")+'">'+t+"</div>"}}),Ext.define("Ext.ux.FilteredCombo",{extend:"Ext.form.field.ComboBox",alias:"widget.filteredcombo",queryCaching:!1,getParams:function(){var u=this.callParent(arguments),r,f,t,i;if(Ext.isArray(this.formParams)){r=this.up("form");if(r)for(f=r.getForm(),t=0;t<this.formParams.length;t++)i=f.findField(this.formParams[t]),i&&(u[this.formParams[t]]=i.getValue())}return u}}),Ext.define("Ext.ux.grid.plugin.ActionManager",{constructor:function(n){this.actions=[],this.keyActions=[],n=n||{},Ext.applyIf(n,{bindContextMenu:!0,clearSelection:!0}),n.actions&&(this.add(n.actions),delete n.actions),Ext.apply(this,n)},init:function(n){this.grid=n,n.mon(n.getSelectionModel(),"selectionchange",this.onSelectionChanged,this),n.mon(n.store,"load",this.onSelectionChanged,this),this.bindContextMenu&&(n.mon(n,"containercontextmenu",this.onContextMenu,this),n.mon(n,"itemcontextmenu",this.onCellContextMenu,this)),this.initKeyMap()},initKeyMap:function(){if(!this.keyActions.length||this.keyMap)return;if(!this.grid.rendered){this.grid.on("render",this.initKeyMap,this);return}this.keyMap=this.grid.el.addKeyMap(this.keyActions),delete this.keyActions},onSelectionChanged:function(){for(var i=this.grid.getSelectionModel().getCount(),n,t=0;t<this.actions.length;t++)n=this.actions[t],n.setDisabled&&n.initialConfig&&(n.initialConfig.enableOnMulti?n.setDisabled(i==0):n.initialConfig.enableOnSingle&&(i!=1?n.setDisabled(!0):typeof n.initialConfig.enableOnSingle=="function"?n.setDisabled(!n.initialConfig.enableOnSingle(this.grid.getSelectionModel().getSelection()[0])):n.setDisabled(!1)))},add:function(n){var r,t,i;if(!n)return n;if(Ext.isArray(n)){for(r=[],t=0;t<n.length;t++)r.push(this.add(n[t]));return r}return n.setDisabled?this.actions.push(n):typeof n=="string"?this.actions.push(n):this.actions.push(n=new Ext.Action(n)),n.initialConfig&&n.initialConfig.key&&(i={key:n.initialConfig.key,shift:n.initialConfig.shift,ctrl:n.initialConfig.ctrl,alt:n.initialConfig.alt,handler:function(){if(n.isDisabled())return;n.execute()}},this.keyMap?this.keyMap.addBinding(i):this.keyActions.push(i)),n},onCellContextMenu:function(n,t,i,r,u){this.grid.getSelectionModel().select(r),this.showContextMenu(u,!1),u.stopEvent()},onContextMenu:function(n,t){Ext.defer(this.showContextMenu,10,this,[t,this.clearSelection]),t.stopEvent()},showContextMenu:function(n,t){this.contextMenu||(this.contextMenu=new Ext.menu.Menu(Ext.apply({items:this.getContextMenuActions()},this.contextMenuConfig)));if(this.contextMenu.hidden){t&&this.grid.getSelectionModel().clearSelections();var i=n.getXY();this.contextMenu.showAt(i)}},getActions:function(){return this.actions},getContextMenuActions:function(){for(var t=[],n=0;n<this.actions.length;n++)this.actions[n]==="->"?t.push("-"):t.push(this.actions[n]);return t}}),Ext.define("Ext.ux.grid.plugin.AutoSelect",{autoSelect:!0,defaultLast:!0,defaultFirst:!1,preserveSelection:!0,constructor:function(n){Ext.apply(this,n)},init:function(n){this.firstLoad=n.store.getCount()==0,this.grid=n,n.mon(n.store,"load",this.restoreSelection,this),n.mon(n.store,"write",this.restoreSelection,this),this.preserveSelection&&(n.mon(n.store,"beforeload",this.saveSelection,this),n.mon(n.store,"beforesync",this.saveSelection,this))},saveSelection:function(){if(this.firstLoad)this.firstLoad=!1;else{var n=this.grid.getSelectionModel();n.getSelection&&(this.selection=n.getSelection())}},restoreSelection:function(){var r,n,i,u,t;if(this.selection){for(r=this.grid.getSelectionModel(),n=[],i=0;i<this.selection.length;i++)t=this.selection[i],u=this.grid.store.getById(t.internalId),u&&n.push(u);this.defaultLast&&n.length==0&&this.grid.store.getCount()>0&&r.select(this.grid.store.getAt(this.grid.store.getCount()-1)),this.defaultFirst&&n.length==0&&this.grid.store.getCount()>0?r.select(this.grid.store.getAt(0)):r.select(n)}else this.grid.store.getCount()>0&&(t=this.grid.store.getAt(0),this.grid.getSelectionModel().select(t))}}),Ext.define("Ext.ux.KeyMapPlugin",{init:function(n){n.mon(n,"render",function(){if(this._keyMap||!this.keyMap)return;this._keyMap=this.el.addKeyMap(this.keyMap)},n)}}),Ext.define("Ext.ux.PageSizeComboBox",{extend:"Ext.form.ComboBox",alias:["widget.pagesizecombo"],constructor:function(n){if(!n.store)throw"PageSizeComboBox: target store not set.";n.targetStore=n.store,n.value=n.targetStore.pageSize,n.store=Ext.create("Ext.data.ArrayStore",{fields:["id"],data:[[5],[10],[15],[20],[25],[30],[40],[50],[60],[80],[100]]}),Ext.apply(n,{valueField:"id",displayField:"id",disableKeyFilter:!0,editable:!1,queryMode:"local",width:50,listeners:{scope:this,select:function(n,t){var r=t[0].get("id"),u=(this.targetStore.currentPage-1)*this.targetStore.pageSize,i;this.targetStore.pageSize=r||5,i=Math.floor(u/r+1),(!i||i<1)&&(i=1),this.targetStore.loadPage(i)}}}),this.callParent(arguments)}}),Ext.ns("Dextop"),Ext.apply(Dextop,{errorText:"Error",warningText:"Warning",confirmText:"Confirmation",infoText:"Information",saveText:"Save",cancelText:"Cancel",editText:"Edit",addText:"Add",removeText:"Remove",reloadText:"Reload",create:function(n,t){if(!n||!n.alias)throw"Cannot instantate Dextop object as no type alias is specified!";t&&Ext.apply(n,t);var i=n.alias;return delete n.alias,Ext.create(i,n)},applyRecursive:function(n,t,i){i&&Dextop.applyRecursive(n,i);if(n&&t&&typeof t=="object")for(var r in t)n[r]=Ext.isObject(n[r])&&Ext.isObject(t[r])?Dextop.applyRecursive(n[r],t[r]):t[r];return n},createGridColumns:function(n,t){return Dextop.data.GridColumnsFactory.create(n,t)},alert:function(n){Dextop.getSession().alert(n)},infoAlert:function(n){typeof n=="string"&&(n={msg:n}),n.type="info",Dextop.alert(n)},warningAlert:function(n){typeof n=="string"&&(n={msg:n}),n.type="warning",Dextop.alert(n)},errorAlert:function(n){typeof n=="string"&&(n={msg:n}),n.type="error",Dextop.alert(n)},getSession:function(){return Dextop.Session.getInstance()},notify:function(n){Dextop.getSession().notify(n)},confirm:function(n){n=Ext.applyIf({title:this.confirmText,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION},n),Ext.Msg.show(n)},warningConfirm:function(n){n=Ext.applyIf({title:this.warningText,buttons:Ext.Msg.YESNO,icon:Ext.Msg.WARNING},n),Ext.Msg.show(n)},blockingConfirm:function(n){return confirm(n.msg||n)},absolutePath:function(n){return Dextop.getSession().getAbsolutePath(n)},downloadAttachment:function(n){var i=Ext.core.DomHelper.append(Ext.getBody(),{tag:"iframe",src:n,style:"display:none",width:0,height:0,frameborder:0}),t=new Ext.util.DelayedTask(function(){Ext.removeNode(i)});t.delay(1e3)},localize:function(n,t){var i=Ext.ClassManager.get(n);i&&i.prototype&&Ext.apply(i.prototype,t)}}),Ext.override(Ext.data.reader.Array,{getIdProperty:function(){var i=this.model.prototype,n=Ext.isDefined(this.idProperty)?this.idProperty:i.idProperty,t;if(typeof n=="string"){t=i.fields.indexOfKey(n);if(t==-1)throw"Id property of the model '"+this.model.displayName+"' could not be found.";n=t}return n}}),Ext.override(Ext.data.reader.Reader,{buildExtractors:function(n){var t=this,f=t.getIdProperty(),e=t.totalProperty,u=t.successProperty,i=t.messageProperty,r;n===!0&&delete t.extractorFunctions;if(t.extractorFunctions)return;e&&(t.getTotal=t.createAccessor(e)),u&&(t.getSuccess=t.createAccessor(u)),i&&(t.getMessage=t.createAccessor(i)),Ext.isDefined(f)?(r=t.createAccessor(f),t.getId=function(n){var i=r.call(t,n);return i===undefined||i===""?null:i}):t.getId=function(){return null},t.buildFieldExtractors()}}),Ext.override(Ext.form.field.Checkbox,{getModelData:function(){return this.callParent(arguments)}}),Ext.override(Ext.form.field.Radio,{getModelData:function(){if(!this.checked)return undefined;var n={};return n[this.name]=this.inputValue,n}}),Ext.override(Ext.Action,{removeComponent:function(n){Ext.Array.remove(this.items,n)}}),Ext.versions.extjs.version=="4.0.1"&&Ext.override(Ext.grid.View,{processUIEvent:function(n){var t=this,i=n.getTarget(t.getItemSelector(),t.getTargetEl()),o=this.statics().EventMap,f,r,e=n.type,s=t.mouseOverItem,u;i||(e=="mouseover"&&t.stillOverItem(n,s)&&(i=s),e=="keydown"&&(r=t.getSelectionModel().getLastSelected(),r&&(i=t.getNode(r))));if(i){f=t.indexOf(i),r||(r=t.getRecord(i));if(t.processItemEvent(r,i,f,n)===!1)return!1;u=t.isNewItemEvent(i,n);if(u===!1)return!1;if(o[u]&&(t["onBeforeItem"+o[u]](r,i,f,n)===!1||t.fireEvent("beforeitem"+u,t,r,i,f,n)===!1||t["onItem"+o[u]](r,i,f,n)===!1))return!1;t.fireEvent("item"+u,t,r,i,f,n)}else{if(o[u]&&(t.processContainerEvent(n)===!1||t["onBeforeContainer"+o[e]](n)===!1||t.fireEvent("beforecontainer"+e,t,n)===!1||t["onContainer"+o[e]](n)===!1))return!1;t.fireEvent("container"+e,t,n)}return!0}}),Ext.override(Ext.data.AbstractStore,{setProxy:function(n){var t=this;return n instanceof Ext.data.proxy.Proxy||n.setModel?n.setModel(t.model):(Ext.isString(n)&&(n={type:n}),Ext.applyIf(n,{model:t.model}),n=Ext.createByAlias("proxy."+n.type,n)),t.proxy=n}}),Ext.override(Ext.data.Store,{autoRevert:undefined,insertPhantom:function(n,t){var i=this.autoSync;this.autoSync=!1,this.insert(n,t),this.autoSync=i},revertFailedOperation:function(n){var t=n.getRecords(),r,i;if(t.length==0)return;r=this;switch(n.action){case"create":r.remove(t);break;case"update":for(i=0;i<t.length;i++)t[i].reject();break;case"destroy":r.removed=[],r.loadRecords(t,{addRecords:!0})}},onBatchException:function(n,t){var r=this.autoRevert||this.autoReject,i;if(r)if(this.operation)this.revertFailedOperation(t);else for(i=0;i<n.operations.length;i++)this.revertFailedOperation(n.operations[i])}}),Ext.override(Ext.menu.Menu,{ignoreParentClicks:!0,listeners:{render:{fn:function(n){var t=n.getEl();t.on("contextmenu",function(n){n.preventDefault()});t.on("unload",t.removeAllListeners,t)}}}}),Ext.override(Ext.grid.plugin.RowEditing,{constructor:function(n){var t=this;Ext.apply(t,n),t.addEvents("beforeedit","edit","canceledit"),t.mixins.observable.constructor.call(t)},init:function(n){var t=this;t.grid=n,t.view=n.view,t.initEvents(),t.initFieldAccessors(n.headerCt.getGridColumns()),n.relayEvents(t,["canceledit","beforeedit","edit"])},cancelEdit:function(){var n=this;this.editing&&(this.getEditor().cancelEdit(),this.editing=!1,this.fireEvent("canceledit",this.context),this.removePhantomsOnCancel&&(this.context.record.phantom?this.context.store.remove(this.context.record):this.context.record.reject()))}}),Ext.override(Ext.form.field.ComboBox,{setValue:function(n,t){var i=this,c=i.valueNotFoundText,o=i.inputEl,u,h,r,s=[],e=[],f=[];if(i.store.loading)return i.value=n,i.setHiddenValue(i.value),i;for(n=Ext.Array.from(n),u=0,h=n.length;u<h;u++)r=n[u],r&&r.isModel||(r=i.findRecordByValue(r)),r?(s.push(r),e.push(r.data),f.push(r.get(i.valueField))):i.forceSelection?Ext.isDefined(c)&&(e.push(c),f.push(n[u])):(e.push(n[u]),f.push(n[u]));return i.setHiddenValue(f),i.value=i.multiSelect?f:f[0],Ext.isDefined(i.value)||(i.value=null),i.displayTplData=e,i.lastSelection=i.valueModels=s,o&&i.emptyText&&!Ext.isEmpty(n)&&o.removeCls(i.emptyCls),i.setRawValue(i.getDisplayValue()),i.checkChange(),t!==!1&&i.syncSelection(),i.applyEmptyText(),i}}),Ext.define("Dextop.ItemFactory",{itemOverrides:{},overrideItems:function(n){Dextop.applyRecursive(this.itemOverrides,n)},getDictionary:function(){return undefined},getItems:function(n){n=n||{};var t=Ext.merge({},this.getDictionary(n),this.itemOverrides,n.apply);return this.buildItems(t)},buildItems:function(){throw"Dextop.ItemFactory.buildItems method is abstract and therefore should be overriden.";}}),Ext.ns("Dextop"),Ext.define("Dextop.Panel",{extend:"Ext.panel.Panel",mixins:{remotable:"Dextop.remoting.Remotable"},requires:["Ext.panel.Panel","Dextop.remoting.Remotable"],constructor:function(n){n.remote&&(this.initRemote(n.remote),delete n.remote),this.callParent(arguments)},destroy:function(){try{this.remote.Dispose()}catch(n){}this.destroyRemote(),this.callParent(arguments)}}),Ext.ns("Dextop"),Ext.define("Dextop.Session",{sessionTerminatedReloadText:"Your session is terminated. Would you like start a new session?",mixins:{observable:"Ext.util.Observable",remotable:"Dextop.remoting.Remotable"},requires:["Dextop.remoting.Remotable"],statics:{instance:undefined,initialize:function(n){return Dextop.Session.instance=Dextop.create(n),Dextop.Session.instance.initSession(),Dextop.Session.instance},getInstance:function(){if(!Dextop.Session.instance)throw"Dextop session is not initialized.";return Dextop.Session.instance}},constructor:function(n){this.initDirect(n.direct),delete n.direct,this.initRemote(n.remote),delete n.remote;if(n.modules)for(var t in n.modules)n.modules[t]=Dextop.create(Ext.apply(n.modules[t],{session:this}));Ext.Function.defer(function(){this.extendSessionTask=Ext.TaskManager.start({scope:this,run:this.extendExpiry,interval:24e4})},12e4,this),Ext.apply(this,n)},destroy:function(){this.terminate(),this.destroyRemote()},initSession:function(){Ext.tip.QuickTipManager.init()},extendExpiry:function(){this.remote.ExtendSession(function(n){n.success===!1&&n.result&&n.result.type==="session"&&this.terminate()},this)},terminate:function(){if(this.terminated)return;this.terminated=!0,this.extendSessionTask&&(Ext.TaskManager.stop(this.extendSessionTask),delete this.extendSessionTask),this.stopDirect()},handleSessionTermination:function(){if(this.terminated)return;this.terminate(),Dextop.warningAlert({msg:this.sessionTerminatedReloadText,buttons:Ext.MessageBox.YESNO,scope:this,fn:function(n){n=="yes"&&this.restartSession()}})},restartSession:function(){window.location.reload()},handleDirectMessage:function(n){n&&(n.success?Dextop.remoting.Remotable.dispatchServerMessages(n.data):n.data&&n.data.type==="session"&&this.handleSessionTermination())},initDirect:function(n){Ext.Direct.on("message",this.handleDirectMessage,this);if(!n||!n.remotingUrl)throw"Dextop.Direct configuration not specified.";Dextop.remoting.Proxy.ajaxUrlBase=n.remotingUrl+"&ajax=1",this.remotingProvider=Ext.Direct.addProvider({id:"rpc",url:n.remotingUrl,type:"remoting",maxRetries:0,priority:0,actions:{Remote:[{name:"invoke",len:3}]}}),this.fsProvider=Ext.Direct.addProvider({id:"form",url:n.remotingUrl+"&formSubmit=1",type:"remoting",maxRetries:0,priority:0,actions:{Remote:[{name:"submitForm",len:1,formHandler:!0}]}}),n.longPollingUrl?this.pollingProvider=Ext.Direct.addProvider({id:"long-poller",url:n.longPollingUrl,type:"longpolling"}):n.pollingUrl&&(this.pollingProvider=Ext.Direct.addProvider({id:"poller",url:n.pollingUrl,type:"polling",interval:n.pollingInterval||5e3}))},stopDirect:function(){this.remotingProvider&&(Ext.Direct.removeProvider(this.remotingProvider),delete this.remotingProvider),this.fsProvider&&(Ext.Direct.removeProvider(this.fsProvider),delete this.fsProvider),this.pollingProvider&&(Ext.Direct.removeProvider(this.pollingProvider),delete this.pollingProvider)},onServerMessage:function(n){n.type==="notification"&&this.notify(n.data)},notify:function(n){typeof n=="string"&&(n={type:"info",msg:n});var t={info:{title:Dextop.infoText},warning:{title:Dextop.warningText},error:{title:Dextop.errorText}};Ext.applyIf(n,t[n.type]),n.msg=n.message=n.msg||n.message||n.exception||n.text,n.sound&&(n.sound===!0?this.playSound(n.type):this.playSound(n.sound)),n.alert?this.alert(n):this.displayPopupNotification(n)},playSound:function(){},getAbsolutePath:function(n){return n?n.indexOf(this.virtualAppPath)==0?n:n.charAt(0)=="/"?this.virtualAppPath+n.substring(1):this.virtualAppPath+n:n},alert:function(n){typeof n=="string"&&(n={msg:n});var t={info:{title:Dextop.infoText,icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK},warning:{title:Dextop.warningText,icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK},error:{title:Dextop.errorText,icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK}};Ext.applyIf(n,t[n.type||"info"]),n.msg=n.msg||n.message||n.exception||n.text,Ext.MessageBox.show(n)},displayPopupNotification:function(n){var i='<div class="msg '+n.type+'"><h3>'+n.title+"</h3><p>"+n.message+"</p></div>",t;this.msgCt||(this.msgCt=Ext.core.DomHelper.insertFirst(document.body,{id:"msg-div"},!0)),t=Ext.core.DomHelper.append(this.msgCt,i,!0),t.hide(),t.slideIn("t").ghost("t",{delay:4e3,remove:!0})},sharedLookupData:{},getSharedLookupData:function(n){var t=this.sharedLookupData[n];if(!t)throw"Shared lookup data '"+n+"' not found.";return t.data},setSharedLookupData:function(n){var t=this.sharedLookupData[n.name];!n.data||t&&t.version==n.version&&t.registered||(this.remote.RegisterLookupDataVersion(n.name,n.version,{success:function(){n.registered=!0}}),this.sharedLookupData[n.name]=n)}}),Ext.ns("Dextop"),Ext.define("Dextop.Window",{extend:"Ext.window.Window",mixins:{remotable:"Dextop.remoting.Remotable"},requires:["Ext.window.Window","Dextop.remoting.Remotable"],constructor:function(n){n.remote&&(this.initRemote(n.remote),delete n.remote),this.callParent(arguments)},destroy:function(){try{this.remote.Dispose()}catch(n){}this.destroyRemote(),this.callParent(arguments)}})